
<!DOCTYPE html>
<html>
  <head>
    <title>Name</title>
    <link rel="shortcut icon" type="image/png" href="assets/icon.png">
  </head>
  <script>
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.onkeydown = function (event) {
    if (event.keyCode == 123) {
        return false;}}
    document.addEventListener('keydown', function(event) {
    if (event.shiftKey) {
        return false;}});
bg_music = new Audio('assets/audio/main music.ogg')
bg_music.loop = true
death = new Audio('assets/audio/wilhelmscream.mp3')
  </script>
  
<script src="taptapir/taptapir.js"></script>
<script type="text/sunsnake">

#Global Functions
ASSETS_FOLDER = 'assets/'
set_orientation('landscape')
set_background_color('rgb(210,180,140)')
set_window_color('rgb(23,23,23)')
set_scale(1.0)
distance_2d = distance

#Editor Camera Function
def EditorCamera():
    editorMode = True


#Variables
jumping = False
collider_objects = []
moving_blocks = []
laserbeams = []
gravity = 0
velocity = 0
speed = 0.005
movingBlockSpeed = 0.002
groundLevel=0
collidingLeft=False
collidingRight=False
startLevel = False
editorMode = False
FinishedLevelOne = False
FinishedLevelTwo = False
FinishedLevelThree = False
#EditorCamera()
#Block Class
def Block(x=0,y=0,texture='textures/grass_side.png'):
    block = Entity(x=x,y=y,z=player.z,texture=texture, scale=0.05,ypos=y+.05)
    collider_objects.append(block)
    return block

#Moving Block Class
def Moving_Block(x=0,y=0,fromX=0.8,toX=1.2,texture='textures/moving_platform.png'):
    moving_block = Entity(x=x,y=y,z=player.z,texture=texture,scale=0.05,ypos=y+.05,fromX=fromX,toX=toX, movingRight=True)
    collider_objects.append(moving_block)
    moving_blocks.append(moving_block)
    return moving_block

#Laserbeam Class
def Laserbeam(x=0,y=0):
    laserHold=Entity(x=x,y=y,z=player.z,color=color.gray,scale=0.05)
    laserbeam=Entity(x=x-0.0005,y=y-.1465,scale=[0.025,0.25],color=color.red)
    collider_objects.append(laserHold)
    laserbeams.append(laserbeam)
    return laserHold, laserbeam

def LaserbeamFunc():
    for la in laserbeams:
        dist = distance(player.xy,la.xy)
        print(dist)
        if dist<=0.06 and la.visible_self:
            startLevel = True
def disabled():
    for la in laserbeams:
        after 1s:
            la.visible_self=True
            enabled()
def enabled():
    for la in laserbeams:
        after 1s:
            disabled()
            la.visible_self=False
after 1s:
    disabled()

Entity(update=LaserbeamFunc,x=-9999999)
def update():
    speed = 0.005
    ground = groundLevel

    #Death Counter
    deaths_text.x = camera.x
    deaths_text.y = camera.y+.47
    deaths_text.text = `Deaths: ${deaths}`

    #Smooth Camera Follow
    sky.x = camera.x * 1
    sky.y = camera.y * 1
    if not editorMode:
        camera.x = lerp(camera.x, player.x, .025)
        camera.y = lerp(camera.y, player.y+.2, .025)

    #Collision Detection
    for e in collider_objects:
        if player.x>=e.x-0.05 and player.x<=e.x and player.y == e.y:
            collidingRight=True
        if player.x<=e.x+0.05 and player.x>=e.x and player.y == e.y:
            collidingLeft=True
        if e.x > 0:
            if player.y >= e.ypos and player.x >= e.x - 0.042 and player.x <= e.x + 0.042:
                ground = max(ground, e.ypos)
        elif e.x < 0:
            if player.y >= e.ypos and player.x <= e.x + 0.042 and player.x >= e.x - 0.042:
                ground = max(ground, e.ypos)
        else:
            ground = max(ground, 0)
        if player.y>=e.y+.01:
            collidingRight=False
            collidingLeft=False
    
    #Player Movement
    if editorMode:
        if held_keys['w']:
            camera.y += speed
        if held_keys['a']:
            camera.x -= speed
        if held_keys['s']:
            camera.y -= speed
        if held_keys['d']:
            camera.x += speed
    if held_keys['d'] and not collidingRight and not editorMode:
        player.x += speed
        collidingLeft=False
        player.texture='textures/player_right.png'
    if held_keys['a'] and not collidingLeft and not editorMode:
        player.x -= speed
        collidingRight=False
        player.texture='textures/player_left.png'

    if velocity <= 0:
        if player.y >= ground:
            gravity += 0.00035
            player.y -= 0.0007 + gravity
        if player.y <= ground:
            jumping = False
            player.y = ground
    if velocity > 0:
        player.y += velocity / 60
        velocity -= .1
    if held_keys['shift'] and not collidingLeft and not collidingRight and not editorMode:
        player.x += (held_keys['d'] - held_keys['a']) * speed

    #Sets the player at the start
    if startLevel == True:
        player.x = blockOne.x
        player.y = blockOne.y + 0.05
        startLevel = False

    #Death
    if player.y == 0:
        startLevel = True
        deaths += 1
        death.play();

    #Moving Platoform Teleportation
    for mv in moving_blocks:
        if player.x>=mv.x-0.045 and player.x<=mv.x+0.045:
            if player.y<=mv.y+0.05:
                player.x = mv.x
            if player.y>=mv.y-0.05 and player.y<=mv.y+0.05:
                player.x = mv.x
    
    #Moving Platform Movement
    for mv in moving_blocks:
        if mv.x >= mv.toX:
            mv.movingRight = False
        
        if mv.x<=mv.fromX:
            mv.movingRight = True
        
        if mv.movingRight:
            if mv.x<=mv.toX:
                mv.x += movingBlockSpeed
            
        if not mv.movingRight:
            if mv.x>=mv.fromX:
                mv.x -= movingBlockSpeed

def input(key):
    if not editorMode:
        if key == 'space' and not jumping:
            ground=player.y
            velocity = 1.2
            gravity = 0
            jumping = True
                
player = Entity(texture='textures/player_right.png', scale=0.05)
sky = Entity(texture='textures/sky.png', scale=[1.8,1.005], z=10)

deaths = 0
deaths_text = Text(text='Deaths: 00', text_origin=[0,0], scale=0.75, y=-.85, text_size=5, text_color=color.white, x=-.38)

startLevel = True

###################
###BUILDING ZONE###
###################

###########
# Level One
###########
#lass=Laserbeam(x=.2,y=.5)
def level1():
    blockOne = Block(x=0.1,y=0.15)
    blockTwo = Block(x=0.2,y=0.2)
    blockThree = Block(x=0.3,y=0.2)
    blockFour = Block(x=0.4,y=0.3)
    blockFive = Block(x=0.5,y=0.35)
    blockSix = Block(x=0.7,y=0.3)
    movingBlockOne = Moving_Block(x=0.75,y=0.3,fromX=0.75,toX=1.2)
    blockSeven = Block(x=1.25,y=0.3)
    movingBlockTwo = Moving_Block(x=1.3,y=0.4,fromX=1.3,toX=1.6)
    blockEight = Block(x=1.65,y=0.35)
    blockNine = Block(x=1.75,y=0.35)
    finishFlag = Entity(scale=[0.05,0.1],texture='textures/finish.png',x=1.75,y=0.425,update=flag)

level1()

def flag():
    dist = distance_2d(player.xy, finishFlag.xy)
    if dist<=0.025 and FinishedLevelOne == False:
        l1.enabled = True
        FinishedLevelOne = True
        startLevel = True
        for e in collider_objects:
            e.enabled = False
        for mv in moving_blocks:
            mv.enabled = False
    elif dist<=0.025 and FinishedLevelOne == True and FinishedLevelTwo == False:
        l2.enabled = True
        FinishedLevelTwo = True
        startLevel = True
        for e in collider_objects:
            e.enabled = False
        for mv in moving_blocks:
            mv.enabled = False

intro_part_1 = Button(scale=3, color=color.black, text_color='white', text='Welcome to the GAME!', z=-10)
intro_part_1.on_click = def():
    intro_part_1.enabled = False



intro_part_2 = Button(texture='textures/the lads.png',scale=2, color=color.black, text_color='white', text='A game made by RangerRhino23 and Itsbailey X3525.', z=-9)
intro_part_2.on_click = def():
    intro_part_2.enabled = False
    bg_music.play()

###########
# Level Two
###########

def level2():
    blockOne = Block(x=0.1,y=0.15)
    
    finishFlag = Entity(scale=[0.05,0.1],texture='textures/finish.png',x=1.75,y=0.425,update=flag)

# Misc stuff


l1 = Button(scale=3, color=color.black, text_color='white', text=`Level 1 complete!`, z=-9)
l1.enabled = False
l1.on_click = def():
    l1.enabled = False
    collider_objects = []  
    moving_blocks = []
    level2()

l2 = Button(scale=3, color=color.black, text_color='white', text=`Level 2 complete!`, z=-9)
l2.enabled = False
l2.on_click = def():
    l2.enabled = False
    collider_objects = []  
    moving_blocks = []
    level3()

    </script><script src="taptapir/sunsnake_compiler.js"></script></html>